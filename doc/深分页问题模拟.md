## æ–¹æ¡ˆä¸€ï¼šç”¨ `create_time` åšæ¸¸æ ‡åˆ†é¡µï¼ˆæ¨èï¼çœŸå®åœºæ™¯ï¼‰

### 1. æ¨¡æ‹ŸèƒŒæ™¯ï¼ˆå®Œå…¨åˆç†ï¼‰

- ç”¨æˆ·æŸ¥çœ‹ **2024 å¹´æŸéƒ¨é—¨çš„æ‰€æœ‰é¢„ç®—è®°å½•**
- æŒ‰ **åˆ›å»ºæ—¶é—´å€’åº**ï¼ˆæœ€æ–°é¢„ç®—åœ¨å‰ï¼‰
- æ•°æ®é‡ï¼šå‡è®¾è¯¥éƒ¨é—¨æœ‰ **80 ä¸‡æ¡è®°å½•**ï¼ˆå¤§éƒ¨é—¨å®Œå…¨å¯èƒ½ï¼‰

### 2. æŸ¥è¯¢è¯­å¥ï¼ˆæ·±åˆ†é¡µå…¸å‹ï¼‰

```sql
-- æŸ¥ç¬¬ 25001 é¡µï¼ˆæ¯é¡µ 20 æ¡ï¼Œè·³è¿‡ 50 ä¸‡æ¡ï¼‰
SELECT * FROM budget_records 
WHERE dept_id = 500 AND YEAR = 2024 AND STATUS = 1
ORDER BY create_time DESC, id DESC
LIMIT 500000, 20;
```

> ğŸ’¡ å³ä½¿å•éƒ¨é—¨ 80 ä¸‡æ¡ï¼Œä¹Ÿè¶³å¤Ÿæ¨¡æ‹Ÿ `offset=500000`ï¼

### 3. å¦‚ä½•ç¡®ä¿å•éƒ¨é—¨æœ‰è¶³å¤Ÿæ•°æ®ï¼Ÿ

å¦‚æœä½ å½“å‰æ•°æ®åˆ†å¸ƒä¸å‡ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹ SQL **ä¸´æ—¶â€œåˆ¶é€ â€çƒ­ç‚¹éƒ¨é—¨**ï¼š

```sql
-- å°†éƒ¨åˆ†æ•°æ®çš„ dept_id æ”¹ä¸º 998ï¼ˆæ¨¡æ‹Ÿå¤§éƒ¨é—¨ï¼‰
UPDATE budget_records 
SET dept_id = 998 
WHERE id BETWEEN 1 AND 900000; -- æ”¹ 60 ä¸‡æ¡

-- ç„¶åæµ‹è¯• dept_id = 998
```

> âš ï¸ æµ‹è¯•å®Œè®°å¾—æ”¹å›å»æˆ–ç”¨æµ‹è¯•åº“ï¼

```sql
EXPLAIN SELECT * FROM budget_records 
WHERE dept_id = 998 AND YEAR = 2024 AND STATUS = 1
ORDER BY create_time DESC, id DESC
LIMIT 100000, 20;
```

type:ref,possible_keys:idx_budget_query,key:idx_budget_query,rows:186370,Extra:Using index condition; Using filesort

æŸ¥è¯¢éƒ¨é—¨ä¸º998çš„æ•°æ®ï¼Œæ»¡è¶³æ¡ä»¶æœ‰18ä¸‡æ¡æ•°æ®ï¼ŒLimit 100000+çš„æ—¶å€™ï¼Œè§¦å‘æ·±åˆ†é¡µ

## æµ‹è¯•ç¬¦åˆæ¡ä»¶çš„æ•°æ®é‡

```sql
SELECT COUNT(*) 
FROM budget_records 
WHERE dept_id = 998 AND YEAR = 2024 AND STATUS = 1;
```

ç»“æœ135314

apifoxæµ‹è¯•æ¥å£ http://localhost:8029/api/budget/listpage?deptId=998&year=2024&status=1&page=5001&size=20

é¢„è®¡æŸ¥è¯¢ 5001 * 20 =100000æ¡æ•°æ® < 135314,æ»¡è¶³æŸ¥è¯¢èŒƒå›´

 æŸ¥è¯¢æ•ˆç‡ï¼š200 631 ms 4.60 K

æŸ¥è¯¢ç»“æœï¼š

```json
{
    "content": [
        {
            "id": 235216,
            "deptId": 998,
            "projectCode": "PROJ-D03916-P753",
            "year": 2024,
            "month": 4,
            "amount": 2639563.56,
            "status": 1,
            "version": "v1",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235205,
            "deptId": 998,
            "projectCode": "PROJ-D05499-P860",
            "year": 2024,
            "month": 5,
            "amount": 1970605.31,
            "status": 1,
            "version": "adjust_q2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235198,
            "deptId": 998,
            "projectCode": "PROJ-D02612-P150",
            "year": 2024,
            "month": 5,
            "amount": 750374.98,
            "status": 1,
            "version": "adjust_q2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235196,
            "deptId": 998,
            "projectCode": "PROJ-D02612-P656",
            "year": 2024,
            "month": 2,
            "amount": 1521038.73,
            "status": 1,
            "version": "adjust_q2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235192,
            "deptId": 998,
            "projectCode": "PROJ-D02612-P137",
            "year": 2024,
            "month": 3,
            "amount": 2731536.73,
            "status": 1,
            "version": "adjust_q2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235190,
            "deptId": 998,
            "projectCode": "PROJ-D02612-P883",
            "year": 2024,
            "month": 1,
            "amount": 1409353.93,
            "status": 1,
            "version": "v1",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235189,
            "deptId": 998,
            "projectCode": "PROJ-D00092-P095",
            "year": 2024,
            "month": 11,
            "amount": 1246352.06,
            "status": 1,
            "version": "final",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235186,
            "deptId": 998,
            "projectCode": "PROJ-D00092-P163",
            "year": 2024,
            "month": 1,
            "amount": 264903.07,
            "status": 1,
            "version": "adjust_q2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235185,
            "deptId": 998,
            "projectCode": "PROJ-D00092-P646",
            "year": 2024,
            "month": 4,
            "amount": 2305617.39,
            "status": 1,
            "version": "adjust_q2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235177,
            "deptId": 998,
            "projectCode": "PROJ-D06015-P588",
            "year": 2024,
            "month": 9,
            "amount": 3883065.46,
            "status": 1,
            "version": "v2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235169,
            "deptId": 998,
            "projectCode": "PROJ-D02888-P463",
            "year": 2024,
            "month": 4,
            "amount": 4036505.22,
            "status": 1,
            "version": "final",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235167,
            "deptId": 998,
            "projectCode": "PROJ-D02888-P119",
            "year": 2024,
            "month": 12,
            "amount": 1788785.84,
            "status": 1,
            "version": "v2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235155,
            "deptId": 998,
            "projectCode": "PROJ-D08373-P092",
            "year": 2024,
            "month": 9,
            "amount": 3743715.87,
            "status": 1,
            "version": "v1",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235154,
            "deptId": 998,
            "projectCode": "PROJ-D08373-P206",
            "year": 2024,
            "month": 10,
            "amount": 1057707.05,
            "status": 1,
            "version": "v1",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235149,
            "deptId": 998,
            "projectCode": "PROJ-D07832-P030",
            "year": 2024,
            "month": 5,
            "amount": 2321082.95,
            "status": 1,
            "version": "adjust_q2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235146,
            "deptId": 998,
            "projectCode": "PROJ-D07832-P105",
            "year": 2024,
            "month": 10,
            "amount": 3787278.94,
            "status": 1,
            "version": "adjust_q2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235144,
            "deptId": 998,
            "projectCode": "PROJ-D07832-P519",
            "year": 2024,
            "month": 1,
            "amount": 2069729.20,
            "status": 1,
            "version": "v2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235142,
            "deptId": 998,
            "projectCode": "PROJ-D07832-P672",
            "year": 2024,
            "month": 1,
            "amount": 934402.30,
            "status": 1,
            "version": "v1",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235137,
            "deptId": 998,
            "projectCode": "PROJ-D02365-P403",
            "year": 2024,
            "month": 12,
            "amount": 1346652.65,
            "status": 1,
            "version": "adjust_q2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        },
        {
            "id": 235120,
            "deptId": 998,
            "projectCode": "PROJ-D01807-P404",
            "year": 2024,
            "month": 9,
            "amount": 4084610.03,
            "status": 1,
            "version": "final",
            "currency": "CNY",
            "createTime": "2025-11-05T02:33:24",
            "updateTime": "2025-11-12T18:24:41"
        }
    ],
    "pageable": {
        "pageNumber": 5001,
        "pageSize": 20,
        "sort": {
            "empty": false,
            "sorted": true,
            "unsorted": false
        },
        "offset": 100020,
        "unpaged": false,
        "paged": true
    },
    "last": false,
    "totalPages": 6766,
    "totalElements": 135314,
    "size": 20,
    "number": 5001,
    "sort": {
        "empty": false,
        "sorted": true,
        "unsorted": false
    },
    "numberOfElements": 20,
    "first": false,
    "empty": false
}
```



**å·²ç»æˆåŠŸå¤ç°**æ·±åˆ†é¡µé—®é¢˜ã€‚

| æŒ‡æ ‡            | å€¼                            | è¯´æ˜                                             |
| --------------- | ----------------------------- | ------------------------------------------------ |
| `totalElements` | **135,314**                   | æ€»æ•°æ®é‡ âœ”ï¸                                       |
| è¯·æ±‚ `page`     | **5001**ï¼ˆ0-basedï¼‰           | å¯¹åº” `offset = 5001 Ã— 20 = 100,020` âœ”ï¸            |
| å®é™…è¿”å›        | **20 æ¡æ•°æ®**                 | éç©ºï¼Œè¯´æ˜æœªè¶Šç•Œ âœ”ï¸                               |
| `totalPages`    | **6766**ï¼ˆ= ceil(135314/20)ï¼‰ | æœ€å¤§é¡µç æ˜¯ 6765ï¼ˆ0-basedï¼‰ï¼Œ5001 < 6765 â†’ åˆæ³• âœ”ï¸ |
| **å“åº”æ—¶é—´**    | **631 ms**                    | âš ï¸ æ˜æ˜¾åé«˜ï¼Œå…¸å‹æ·±åˆ†é¡µç“¶é¢ˆ âœ”ï¸                     |

## ä¸ºä»€ä¹ˆè€—æ—¶ 631msï¼Ÿâ€”â€” æ ¹æœ¬åŸå› 

ä»ä½ ä¹‹å‰çš„ `EXPLAIN` å¯çŸ¥ï¼š

```text
Extra: Using index condition; Using filesort
```

è¯´æ˜ï¼š

1. **WHERE æ¡ä»¶å‘½ä¸­äº†ç´¢å¼•**ï¼ˆ`idx_budget_query`ï¼‰
2. **ä½† ORDER BY (create_time DESC, id DESC) æ— æ³•ç”¨ç´¢å¼•æ’åº** â†’ MySQL å¿…é¡»æŠŠ **13.5 ä¸‡æ¡ä¸­é—´ç»“æœå…¨éƒ¨è¯»å‡ºæ¥** â†’ å†åœ¨å†…å­˜æˆ–ç£ç›˜ä¸Šåš **filesortï¼ˆå¤–éƒ¨æ’åºï¼‰** â†’ ç„¶åè·³è¿‡ 10 ä¸‡æ¡ï¼Œè¿”å›æœ€å 20 æ¡

è¿™ä¸ªè¿‡ç¨‹ï¼š

- CPU å’Œ I/O å¼€é”€å¤§
- éšç€ offset å¢å¤§ï¼Œè€—æ—¶**éçº¿æ€§å¢é•¿**

#### ğŸ”§ ä¼˜åŒ–æ–¹æ¡ˆ 1ï¼šæ·»åŠ è¦†ç›–æ’åºçš„è”åˆç´¢å¼•ï¼ˆæœ€ç®€å•æœ‰æ•ˆï¼‰

```sql
-- åˆ›å»ºæ”¯æŒ WHERE + ORDER BY çš„ç´¢å¼•
CREATE INDEX idx_dept_year_status_ctime_desc 
ON budget_records (dept_id, year, status, create_time DESC, id DESC);
```

> ğŸ’¡ è¿™ä¸ªç´¢å¼•èƒ½è®© MySQLï¼š
>
> - å¿«é€Ÿå®šä½åˆ° `dept_id=998 AND year=2024 AND status=1`
> - **ç›´æ¥æŒ‰ç´¢å¼•é¡ºåºè¯»å–**ï¼Œæ— éœ€ `filesort`
> - æ‰«æåˆ°ç¬¬ 100,020 æ¡å°±åœï¼Œä¸åŠ è½½å¤šä½™æ•°æ®

âœ… **é¢„æœŸæ•ˆæœ**ï¼š

- `EXPLAIN` ä¸­ `Extra` ä¸å†æœ‰ `Using filesort`
- å“åº”æ—¶é—´ä» **631ms â†’ 50~150ms**

------

#### ğŸ”§ ä¼˜åŒ–æ–¹æ¡ˆ 2ï¼šæ”¹é€ æˆæ¸¸æ ‡åˆ†é¡µï¼ˆå½»åº•è§£å†³æ·±åˆ†é¡µï¼‰

å½“ç”¨æˆ·ç¿»åˆ°ç¬¬ 5001 é¡µæ—¶ï¼Œå‰ç«¯åº”ä¼ å…¥ä¸Šä¸€é¡µæœ€åä¸€æ¡çš„ `(create_time, id)`ï¼š

```java
// Repository æ–°å¢æ–¹æ³•
@Query(value = """
    SELECT * FROM budget_records
    WHERE dept_id = :deptId AND year = :year AND status = :status
      AND (create_time < :cursorTime OR (create_time = :cursorTime AND id < :cursorId))
    ORDER BY create_time DESC, id DESC
    LIMIT :size
    """, nativeQuery = true)
List<BudgetRecord> findNextPageByCursor(
    @Param("deptId") Integer deptId,
    @Param("year") Integer year,
    @Param("status") Integer status,
    @Param("cursorTime") LocalDateTime cursorTime,
    @Param("cursorId") Long cursorId,
    @Param("size") int size
);
```

âœ… **ä¼˜åŠ¿**ï¼š

- æ°¸è¿œ `LIMIT 20`ï¼Œæ—  offset
- å§‹ç»ˆèµ°ç´¢å¼•ï¼Œ**ç¨³å®š 10~30ms**
- ä¸éœ€è¦ `COUNT(*)`ï¼Œé¿å…æ€»æ•°æŸ¥è¯¢å¼€é”€

###  **å‰ç«¯æ€ä¹ˆè·å–â€œæœ€åä¸€æ¡çš„æ—¶é—´å’Œ IDâ€ï¼Ÿ**

> **åç«¯åœ¨è¿”å›æ•°æ®æ—¶ï¼Œä¸»åŠ¨å‘Šè¯‰å‰ç«¯ä¸‹ä¸€é¡µçš„æ¸¸æ ‡ï¼**

## æ–¹æ¡ˆï¼šå“åº”ä¸­å¢åŠ  `nextCursor` å­—æ®µ

```json
{
  "data": [
    { "id": 235216, "createTime": "2025-11-05T02:33:24", ... },
    { "id": 235205, "createTime": "2025-11-05T02:33:24", ... },
    ...
  ],
  "hasMore": true,
  "nextCursor": {
    "createTime": "2025-11-05T02:33:24",
    "id": 235120   // â† æœ€åä¸€æ¡çš„ createTime + id
  }
}
```

> âœ… å‰ç«¯ä¸‹æ¬¡è¯·æ±‚æ—¶ï¼ŒæŠŠ `nextCursor` å½“å‚æ•°ä¼ å›æ¥ï¼š
>
> ```text
> GET /api/budget/list?deptId=998&year=2024&status=1&size=20
>     &cursorCreateTime=2025-11-05T02:33:24
>     &cursorId=235120
> ```

## ä¸ºä»€ä¹ˆç”¨ `(createTime, id)` ä½œæ¸¸æ ‡ï¼Ÿ

å› ä¸ºä½ çš„æ’åºæ˜¯ï¼š

```sql
ORDER BY create_time DESC, id DESC
```

è¦å®ç°**æ— è·³è¿‡ã€è¿ç»­ç¿»é¡µ**ï¼Œå¿…é¡»ç”¨æ’åºå­—æ®µä½œä¸ºè¾¹ç•Œæ¡ä»¶ï¼š

- æ‰¾å‡ºæ¯” `(ä¸Šä¸€é¡µæœ€åä¸€æ¡.create_time, ä¸Šä¸€é¡µæœ€åä¸€æ¡.id)` **æ›´å°**çš„è®°å½•
- å³ï¼š`create_time < cursorTime OR (create_time = cursorTime AND id < cursorId)`

> ğŸ”’ è¿™ä¿è¯äº†ï¼š
>
> - ä¸é‡å¤ï¼ˆä¸ä¼šå›åˆ°ä¸Šä¸€é¡µï¼‰
> - ä¸é—æ¼ï¼ˆæŒ‰é¡ºåºå¾€ä¸‹èµ°ï¼‰
> - é«˜æ€§èƒ½ï¼ˆç›´æ¥èµ°ç´¢å¼•ï¼‰

## å‰ç«¯å¦‚ä½•ä½¿ç”¨ï¼Ÿï¼ˆApifox æ¨¡æ‹Ÿï¼‰

### ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼ˆç¬¬ä¸€é¡µï¼‰ï¼š

```text
GET /api/budget/list?deptId=998&year=2024&status=1&size=20
```

â†’ è¿”å›ï¼š

```json
{
  "data": [...20æ¡...],
  "hasMore": true,
  "nextCursor": { "createTime": "2025-11-05T02:33:24", "id": 235120 }
}
```

### ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆç¬¬äºŒé¡µï¼‰ï¼š

```text
GET /api/budget/list?deptId=998&year=2024&status=1&size=20
  &cursorCreateTime=2025-11-05T02:33:24
  &cursorId=235120
```

âœ… å¦‚æ­¤å¾ªç¯ï¼Œç›´åˆ° `hasMore = false`

æ¯æ¬¡æŸ¥è¯¢éƒ½ä¾èµ–ä¸Šä¸€æ¬¡çš„ç»“æœï¼Œå› æ­¤æ— æ³•ç›´æ¥è·³é¡µåˆ°ä¾‹å¦‚1000é¡µï¼Œæ¯æ¬¡æŸ¥è¯¢çš„é€Ÿåº¦ä¹Ÿéƒ½æ˜¯ä¸€è‡´çš„ã€‚

## âœ… é‚£äº§å“ä¸Šæ€ä¹ˆå¤„ç†ï¼Ÿâ€”â€” å®é™…ä¸šåŠ¡ç­–ç•¥

è™½ç„¶æŠ€æœ¯ä¸Šä¸èƒ½è·³é¡µï¼Œä½†**ç”¨æˆ·ä½“éªŒå¯ä»¥ä¼˜åŒ–**ï¼š

### 1. **åªæä¾›â€œåŠ è½½æ›´å¤šâ€æŒ‰é’®ï¼ˆæœ€å¸¸è§ï¼‰**

- å¾®åšã€Twitterã€æœ‹å‹åœˆã€è¯„è®ºåŒº
- ç”¨æˆ·æ»šåŠ¨åˆ°åº•éƒ¨ â†’ è‡ªåŠ¨åŠ è½½ä¸‹ä¸€é¡µ
- **æ ¹æœ¬ä¸éœ€è¦â€œé¡µç â€**

### 2. **å…è®¸æœç´¢/ç­›é€‰ç¼©å°èŒƒå›´**

- å¦‚æœç”¨æˆ·çœŸæƒ³å¿«é€Ÿå®šä½ï¼Œåº”è¯¥é€šè¿‡ **æœç´¢å…³é”®è¯ã€æ—¶é—´èŒƒå›´ã€çŠ¶æ€ç­›é€‰** æ¥å‡å°‘æ€»æ•°æ®é‡
- ä¾‹å¦‚ï¼šâ€œåªçœ‹ 2024 å¹´ Q3 çš„é¢„ç®—â€ â†’ æ€»æ•°å˜å°‘ï¼Œç¿»å‡ é¡µå°±åˆ°åº•

### 3. **æ··åˆæ–¹æ¡ˆï¼ˆæå°‘ç”¨ï¼‰**

- å‰ 100 é¡µç”¨ä¼ ç»Ÿåˆ†é¡µï¼ˆæ”¯æŒè·³è½¬ï¼‰
- è¶…è¿‡ 100 é¡µåæç¤ºï¼šâ€œæ•°æ®é‡è¿‡å¤§ï¼Œè¯·ä½¿ç”¨ç­›é€‰æ¡ä»¶â€ æˆ– åˆ‡æ¢ä¸ºâ€œåŠ è½½æ›´å¤šâ€
- ï¼ˆä½†å®ç°å¤æ‚ï¼Œä¸€èˆ¬ä¸æ¨èï¼‰

â€œä¸ºè§£å†³æ·±åˆ†é¡µæ€§èƒ½ç“¶é¢ˆï¼Œç³»ç»Ÿé‡‡ç”¨æ¸¸æ ‡åˆ†é¡µæœºåˆ¶ã€‚ç”¨æˆ·å¯é€šè¿‡â€˜åŠ è½½æ›´å¤šâ€™æ–¹å¼è¿ç»­æµè§ˆæ•°æ®ã€‚è‹¥éœ€å¿«é€Ÿå®šä½ï¼Œè¯·ç»“åˆéƒ¨é—¨ã€å¹´ä»½ã€çŠ¶æ€ç­‰ç­›é€‰æ¡ä»¶ç¼©å°ç»“æœé›†ã€‚â€

ç¬¬ä¸€æ¬¡æŸ¥è¯¢

http://localhost:8029/api/budget/listpage/cursor?deptId=998&year=2024&status=1&size=20

APXFOXæ€§èƒ½ï¼š200 623 ms 4.33 K

æŸ¥è¯¢ç»“æœï¼š

```json
{
    "data": [
        {
            "id": 7139594,
            "deptId": 998,
            "projectCode": "PROJ-D00998-P507",
            "year": 2024,
            "month": 8,
            "amount": 4804473.68,
            "status": 1,
            "version": "v1",
            "currency": "CNY",
            "createTime": "2025-11-05T02:35:13",
            "updateTime": "2025-11-05T02:35:13"
        },
        {
            "id": 6995097,
            "deptId": 998,
            "projectCode": "PROJ-D00998-P703",
            "year": 2024,
            "month": 10,
            "amount": 502292.79,
            "status": 1,
            "version": "v2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:35:11",
            "updateTime": "2025-11-05T02:35:11"
        },
       ...
        {
            "id": 6080257,
            "deptId": 998,
            "projectCode": "PROJ-D00998-P269",
            "year": 2024,
            "month": 1,
            "amount": 485766.04,
            "status": 1,
            "version": "v1",
            "currency": "CNY",
            "createTime": "2025-11-05T02:34:56",
            "updateTime": "2025-11-05T02:34:56"
        },
        {
            "id": 5929832,
            "deptId": 998,
            "projectCode": "PROJ-D00998-P130",
            "year": 2024,
            "month": 6,
            "amount": 4977702.47,
            "status": 1,
            "version": "v2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:34:54",
            "updateTime": "2025-11-05T02:34:54"
        }
    ],
    "hasMore": true,
    "nextCursor": {
        "createTime": "2025-11-05T02:34:54",
        "id": 5929832
    }
}
```

æ¸¸æ ‡åˆ†é¡µä¾èµ–å¯¹åº”çš„ç´¢å¼•ï¼Œç›®å‰æ•°æ®åº“æ²¡æœ‰ç´¢å¼•ï¼Œå› æ­¤ä¸ç”Ÿæ•ˆã€‚

## åº”è¯¥åˆ›å»ºä»€ä¹ˆç´¢å¼•ï¼Ÿ

### ğŸ¯ ç´¢å¼•è®¾è®¡åŸåˆ™ï¼š**æœ€å·¦å‰ç¼€ + è¦†ç›–æ’åº**

> MySQL çš„ B+ æ ‘ç´¢å¼•è¦æ±‚ï¼š
>
> - **ç­‰å€¼æ¡ä»¶å­—æ®µæ”¾å‰é¢**
> - **æ’åºå­—æ®µæ”¾åé¢ï¼Œé¡ºåºå’Œæ–¹å‘å¿…é¡»ä¸€è‡´**

### ğŸ”§ æ¨èç´¢å¼•ï¼š

```sql
CREATE INDEX idx_budget_cursor 
ON budget_records (dept_id, year, status, create_time DESC, id DESC);
```

| å­—æ®µ               | ä½œç”¨     | è¯´æ˜                             |
| ------------------ | -------- | -------------------------------- |
| `dept_id`          | ç­‰å€¼è¿‡æ»¤ | WHERE æ¡ä»¶ï¼Œé«˜é€‰æ‹©æ€§             |
| `year`             | ç­‰å€¼è¿‡æ»¤ | åŒä¸Š                             |
| `status`           | ç­‰å€¼è¿‡æ»¤ | åŒä¸Š                             |
| `create_time DESC` | æ’åº     | ORDER BY ç¬¬ä¸€å­—æ®µï¼Œ**å¿…é¡» DESC** |
| `id DESC`          | æ’åº     | ORDER BY ç¬¬äºŒå­—æ®µï¼Œ**å¿…é¡» DESC** |

> âš ï¸ æ³¨æ„ï¼š`create_time` å’Œ `id` çš„æ’åºæ–¹å‘å¿…é¡»å’Œ SQL ä¸­çš„ `ORDER BY` **å®Œå…¨ä¸€è‡´**ï¼Œå¦åˆ™æ— æ³•é¿å… `filesort`ã€‚

æ•°æ®åº“æ‰§è¡Œä¸Šè¿°å»ºç´¢å¼•çš„è¯­å¥åï¼Œå†æ¬¡ä½¿ç”¨APIFOXæµ‹è¯•åˆ†é¡µæŸ¥è¯¢

http://localhost:8029/api/budget/listpage/cursor?deptId=998&year=2024&status=1&size=20

ç»“æœï¼š200 27 ms 4.33 K

```json
{
    "data": [
        {
            "id": 7139594,
            "deptId": 998,
            "projectCode": "PROJ-D00998-P507",
            "year": 2024,
            "month": 8,
            "amount": 4804473.68,
            "status": 1,
            "version": "v1",
            "currency": "CNY",
            "createTime": "2025-11-05T02:35:13",
            "updateTime": "2025-11-05T02:35:13"
        },
        ...
        {
            "id": 6080257,
            "deptId": 998,
            "projectCode": "PROJ-D00998-P269",
            "year": 2024,
            "month": 1,
            "amount": 485766.04,
            "status": 1,
            "version": "v1",
            "currency": "CNY",
            "createTime": "2025-11-05T02:34:56",
            "updateTime": "2025-11-05T02:34:56"
        },
        {
            "id": 5929832,
            "deptId": 998,
            "projectCode": "PROJ-D00998-P130",
            "year": 2024,
            "month": 6,
            "amount": 4977702.47,
            "status": 1,
            "version": "v2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:34:54",
            "updateTime": "2025-11-05T02:34:54"
        }
    ],
    "hasMore": true,
    "nextCursor": {
        "createTime": "2025-11-05T02:34:54",
        "id": 5929832
    }
}
```

æŸ¥è¯¢ç¬¬äºŒé¡µï¼Œhttp://localhost:8029/api/budget/listpage/cursor?deptId=998&year=2024&status=1&size=20&cursorTime=2025-11-05T02:34:54&cursorId=5929832ï¼Œç»“æœï¼š200 23 ms 4.38 K

è¿”å›

```json
{
    "data": [
        {
            "id": 5929829,
            "deptId": 998,
            "projectCode": "PROJ-D00998-P221",
            "year": 2024,
            "month": 1,
            "amount": 2239917.59,
            "status": 1,
            "version": "v2",
            "currency": "CNY",
            "createTime": "2025-11-05T02:34:54",
            "updateTime": "2025-11-05T02:34:54"
        },...
        {
            "id": 5227654,
            "deptId": 998,
            "projectCode": "PROJ-D00998-P759",
            "year": 2024,
            "month": 10,
            "amount": 2275947.27,
            "status": 1,
            "version": "v1",
            "currency": "CNY",
            "createTime": "2025-11-05T02:34:43",
            "updateTime": "2025-11-05T02:34:43"
        }
    ],
    "hasMore": true,
    "nextCursor": {
        "createTime": "2025-11-05T02:34:43",
        "id": 5227654
    }
}
```

ç»§ç»­æŸ¥è¯¢ç¬¬ä¸‰é¡µï¼Œhttp://localhost:8029/api/budget/listpage/cursor?deptId=998&year=2024&status=1&size=20&cursorTime=2025-11-05T02:34:43&cursorId=5227654 ç»“æœï¼š200 17 ms 4.34 K











