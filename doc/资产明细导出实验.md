## å®éªŒå‡†å¤‡

### 1.è¡¨ç»“æ„è®¾è®¡ï¼ˆç±»ä¼ä¸š ERP èµ„äº§æ˜ç»†è¡¨ï¼‰

```SQL
CREATE TABLE asset_detail (
                            id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',

  -- åŸºç¡€ä¿¡æ¯
                            asset_code VARCHAR(32) NOT NULL COMMENT 'èµ„äº§ç¼–ç ï¼ˆå”¯ä¸€ï¼‰',
                            asset_name VARCHAR(100) NOT NULL COMMENT 'èµ„äº§åç§°',
                            category_code VARCHAR(20) NOT NULL COMMENT 'èµ„äº§ç±»åˆ«ç¼–ç ï¼ˆå¦‚ IT01, OFFICE02ï¼‰',
                            category_name VARCHAR(50) NOT NULL COMMENT 'èµ„äº§ç±»åˆ«åç§°',

  -- æ‰€å±ç»„ç»‡
                            company_id INT NOT NULL COMMENT 'å…¬å¸ID',
                            company_name VARCHAR(100) NOT NULL COMMENT 'å…¬å¸åç§°',
                            dept_id INT NOT NULL COMMENT 'éƒ¨é—¨ID',
                            dept_name VARCHAR(100) NOT NULL COMMENT 'éƒ¨é—¨åç§°',

  -- è´¢åŠ¡ä¿¡æ¯
                            original_value DECIMAL(18,2) NOT NULL DEFAULT 0.00 COMMENT 'åŸå€¼ï¼ˆå…ƒï¼‰',
                            residual_value DECIMAL(18,2) NOT NULL DEFAULT 0.00 COMMENT 'æ®‹å€¼ï¼ˆå…ƒï¼‰',
                            depreciation_method TINYINT NOT NULL DEFAULT 1 COMMENT 'æŠ˜æ—§æ–¹æ³•ï¼ˆ1-ç›´çº¿æ³•, 2-åŒå€ä½™é¢é€’å‡ï¼‰',
                            accumulated_depreciation DECIMAL(18,2) NOT NULL DEFAULT 0.00 COMMENT 'ç´¯è®¡æŠ˜æ—§',

  -- æ—¶é—´ä¿¡æ¯
                            purchase_date DATE NOT NULL COMMENT 'é‡‡è´­æ—¥æœŸ',
                            use_start_date DATE COMMENT 'å¯ç”¨æ—¥æœŸ',
                            expected_life_months INT NOT NULL DEFAULT 60 COMMENT 'é¢„è®¡ä½¿ç”¨æœˆæ•°',

  -- çŠ¶æ€ä¸ä½ç½®
                            status TINYINT NOT NULL DEFAULT 0 COMMENT 'çŠ¶æ€ï¼ˆ0-åœ¨ç”¨, 1-é—²ç½®, 2-ç»´ä¿®ä¸­, 3-æŠ¥åºŸï¼‰',
                            location VARCHAR(200) COMMENT 'å­˜æ”¾ä½ç½®ï¼ˆæ¥¼æ ‹-æ¥¼å±‚-æˆ¿é—´ï¼‰',
                            custodian VARCHAR(50) COMMENT 'ä¿ç®¡äºº',

  -- ä¾›åº”å•†ä¸åˆåŒ
                            supplier_name VARCHAR(100) COMMENT 'ä¾›åº”å•†',
                            contract_no VARCHAR(50) COMMENT 'åˆåŒç¼–å·',

  -- å®¡è®¡å­—æ®µ
                            created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
                            updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  -- ç´¢å¼•ï¼ˆæ¨¡æ‹ŸçœŸå®ç³»ç»Ÿï¼‰
                            UNIQUE KEY uk_asset_code (asset_code),
                            KEY idx_company_dept (company_id, dept_id),
                            KEY idx_purchase_date (purchase_date),
                            KEY idx_category (category_code),
                            KEY idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='èµ„äº§æ˜ç»†è¡¨';
```

### 2.æ•°æ®è§„æ¨¡è®¾å®š

| ä¼ä¸šç±»å‹               | èµ„äº§æ€»é‡         | è¯´æ˜                                                         |
| ---------------------- | ---------------- | ------------------------------------------------------------ |
| å°å‹ä¼ä¸š               | < 10ä¸‡           | ä¸è¶³ä»¥è§¦å‘ OOM                                               |
| **ä¸­å¤§å‹ä¼ä¸šï¼ˆæ¨èï¼‰** | **80ä¸‡ ~ 200ä¸‡** | âœ… **æœ€ä½³å®éªŒåŒºé—´**ï¼š â€¢ è¶³å¤Ÿå¤§ï¼Œèƒ½ OOM â€¢ æœ¬åœ°å¯ç”Ÿæˆ/å¯¼å…¥ â€¢ ç¬¦åˆé›†å›¢å‹ä¼ä¸šèµ„äº§è§„æ¨¡ï¼ˆå¦‚åˆ¶é€ ã€é‡‘èã€èƒ½æºè¡Œä¸šï¼‰ |
| è¶…å¤§å‹ä¼ä¸š             | > 500ä¸‡          | æœ¬åœ°æµ‹è¯•å¯èƒ½è€—æ—¶è¿‡é•¿                                         |

### ğŸ”¢ æ¨èå®éªŒæ•°æ®é‡ï¼š**120 ä¸‡æ¡**

- æŒ‰ **5 å®¶å­å…¬å¸** åˆ†å¸ƒï¼ˆ`company_id`: 1001~1005ï¼‰
- æ¯å®¶å…¬å¸ **20~30 ä¸ªéƒ¨é—¨**
- èµ„äº§ç±»åˆ«ï¼šITè®¾å¤‡ï¼ˆ40%ï¼‰ã€åŠå…¬å®¶å…·ï¼ˆ30%ï¼‰ã€ç”Ÿäº§è®¾å¤‡ï¼ˆ20%ï¼‰ã€è½¦è¾†ï¼ˆ10%ï¼‰
- é‡‡è´­æ—¥æœŸï¼šé›†ä¸­åœ¨ **2019-01-01 è‡³ 2024-12-31**ï¼ˆ6å¹´ï¼‰
- çŠ¶æ€åˆ†å¸ƒï¼šåœ¨ç”¨ï¼ˆ75%ï¼‰ã€é—²ç½®ï¼ˆ15%ï¼‰ã€ç»´ä¿®ï¼ˆ7%ï¼‰ã€æŠ¥åºŸï¼ˆ3%ï¼‰

> ğŸ’¡ ä¸ºä»€ä¹ˆé€‰ 120wï¼Ÿ
>
> - å…¨é‡åŠ è½½åˆ° Java å¯¹è±¡ â‰ˆ **120w Ã— 500B = 600MB å¯¹è±¡æ•°æ®**ï¼›
> - åŠ ä¸Š POI å†…å­˜å¼€é”€ã€JVM å¯¹è±¡å¤´ã€GC å¼€é”€ â†’ **ææ˜“åœ¨ -Xmx2g ä¸‹ OOM**ï¼›
> - å¯¼å‡ºæ—¶é—´ > 8 åˆ†é’Ÿï¼Œç”¨æˆ·ä½“éªŒå·®ï¼Œé—®é¢˜æ˜æ˜¾ã€‚

### 3.å¯¼å…¥ä¾èµ–

```xml
 <dependency>
  <groupId>org.apache.poi</groupId>
  <artifactId>poi-ooxml</artifactId>
  <version>5.2.4</version>
</dependency>
```

### 4.ç”Ÿæˆæµ‹è¯•æ•°æ®

æ’å…¥160wæ¡æ•°æ®

æ•°æ®åˆ†å¸ƒ

company_name     COUNT(*)

---------------  ----------

é›†å›¢æ€»éƒ¨                 320635
åä¸œåˆ†å…¬å¸                319230
åå—åˆ†å…¬å¸                319730
ååŒ—åˆ†å…¬å¸                320633
è¥¿éƒ¨åˆ†å…¬å¸                319772

æ•°æ®çŠ¶æ€

status_text  COUNT(*)

-----------  ----------

åœ¨ç”¨              1200244
é—²ç½®               239977
ç»´ä¿®ä¸­              111657
æŠ¥åºŸ                48122

é‡‡è´­å¹´ä»½åˆ†å¸ƒ

YEAR(purchase_date)  COUNT(*)

-------------------  ----------

               2019      266801
               2020      267450
               2021      266458
               2022      266092
               2023      265635
               2024      267564

## ä¸€.å…¨é‡å¯¼å‡ºå®éªŒ

##### 1.å…¨é‡åŠ è½½æ•°æ®åˆ°å†…å­˜

160wæ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åå†™å…¥åˆ°åˆ›å»ºçš„excelä¸­

##### 2.ä½¿ç”¨ `XSSFWorkbook`ï¼ˆå…¨å†…å­˜ Excel æ¨¡å‹ï¼‰

```java
XSSFWorkbook workbook = new XSSFWorkbook(); // âŒ .xlsx å…¨åœ¨å†…å­˜ä¸­æ„å»º
```

æµ‹è¯•å‡ºç°OOM

```text
Exception: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread "File Watcher"
Exception in thread "http-nio-8029-Poller" Exception in thread "mysql-cj-abandoned-connection-cleanup" java.lang.OutOfMemoryError: Java heap space
java.lang.OutOfMemoryError: Java heap space
2025-11-13T10:53:25.698+08:00 ERROR 24832 --- [alina-utility-2] org.apache.catalina.core.ContainerBase   : Exception processing background thread

java.util.concurrent.ExecutionException: java.lang.OutOfMemoryError: Java heap space
	at java.base/java.util.concurrent.FutureTask.report(FutureTask.java:122) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.get(FutureTask.java:191) ~[na:na]
	at org.apache.catalina.core.ContainerBase.threadStart(ContainerBase.java:1226) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
	at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessorMonitor.run(ContainerBase.java:1270) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539) ~[na:na]
	at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305) ~[na:na]
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]
Caused by: java.lang.OutOfMemoryError: Java heap space

2025-11-13T10:53:25.830+08:00 ERROR 24832 --- [nio-8029-exec-2] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Handler dispatch failed: java.lang.OutOfMemoryError: Java heap space] with root cause

java.lang.OutOfMemoryError: Java heap space
	at java.base/java.util.Arrays.copyOf(Arrays.java:3512) ~[na:na]
	at java.base/java.util.Arrays.copyOf(Arrays.java:3481) ~[na:na]
	at java.base/java.util.ArrayList.grow(ArrayList.java:237) ~[na:na]
	at java.base/java.util.ArrayList.grow(ArrayList.java:244) ~[na:na]
	at java.base/java.util.ArrayList.add(ArrayList.java:454) ~[na:na]
	at java.base/java.util.ArrayList.add(ArrayList.java:467) ~[na:na]
	at org.apache.xmlbeans.impl.store.Saver.addMapping(Saver.java:623) ~[xmlbeans-5.1.1.jar:na]
	at org.apache.xmlbeans.impl.store.Saver.<init>(Saver.java:102) ~[xmlbeans-5.1.1.jar:na]
	at org.apache.xmlbeans.impl.store.Saver$SynthNamespaceSaver.<init>(Saver.java:793) ~[xmlbeans-5.1.1.jar:na]
	at org.apache.xmlbeans.impl.store.Saver.<init>(Saver.java:117) ~[xmlbeans-5.1.1.jar:na]
	at org.apache.xmlbeans.impl.store.Saver$TextSaver.<init>(Saver.java:834) ~[xmlbeans-5.1.1.jar:na]
	at org.apache.xmlbeans.impl.store.Cursor._xmlText(Cursor.java:535) ~[xmlbeans-5.1.1.jar:na]
	at org.apache.xmlbeans.impl.store.Cursor.lambda$xmlText$11(Cursor.java:1982) ~[xmlbeans-5.1.1.jar:na]
	at org.apache.xmlbeans.impl.store.Cursor$$Lambda$1648/0x00000251cb9bea08.get(Unknown Source) ~[na:na]
	at org.apache.xmlbeans.impl.store.Cursor.syncWrapHelper(Cursor.java:2529) ~[xmlbeans-5.1.1.jar:na]
	at org.apache.xmlbeans.impl.store.Cursor.syncWrap(Cursor.java:2460) ~[xmlbeans-5.1.1.jar:na]
	at org.apache.xmlbeans.impl.store.Cursor.xmlText(Cursor.java:1982) ~[xmlbeans-5.1.1.jar:na]
	at org.apache.xmlbeans.impl.values.XmlObjectBase.xmlText(XmlObjectBase.java:1447) ~[xmlbeans-5.1.1.jar:na]
	at org.apache.poi.xssf.model.SharedStringsTable.xmlText(SharedStringsTable.java:141) ~[poi-ooxml-5.2.4.jar:5.2.4]
	at org.apache.poi.xssf.model.SharedStringsTable.addEntry(SharedStringsTable.java:191) ~[poi-ooxml-5.2.4.jar:5.2.4]
	at org.apache.poi.xssf.model.SharedStringsTable.addSharedStringItem(SharedStringsTable.java:223) ~[poi-ooxml-5.2.4.jar:5.2.4]
	at org.apache.poi.xssf.usermodel.XSSFCell.setCellValueImpl(XSSFCell.java:370) ~[poi-ooxml-5.2.4.jar:5.2.4]
	at org.apache.poi.xssf.usermodel.XSSFCell.setCellValueImpl(XSSFCell.java:353) ~[poi-ooxml-5.2.4.jar:5.2.4]
	at org.apache.poi.ss.usermodel.CellBase.setCellValue(CellBase.java:275) ~[poi-5.2.4.jar:5.2.4]
	at cn.loblok.lcyerp01.service.AssetExportServiceV1.exportAllToFile(AssetExportServiceV1.java:47) ~[classes/:na]
	at cn.loblok.lcyerp01.controller.AssetController.exportV1Debug(AssetController.java:36) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254) ~[spring-web-6.1.1.jar:6.1.1]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182) ~[spring-web-6.1.1.jar:6.1.1]
```



## äºŒ.æ¸¸æ ‡åˆ†é¡µæŸ¥è¯¢ + `SXSSFWorkbook` æµå¼å†™ å¯¼å‡ºå®éªŒ

### 1. **é€‰æ‹©ç¨³å®šçš„æ’åºå­—æ®µ**

- å¿…é¡»æ˜¯ å”¯ä¸€ã€éç©ºã€æœ‰åºçš„å­—æ®µï¼Œé€šå¸¸æ˜¯ï¼š
  - ä¸»é”® `id`ï¼ˆè‡ªå¢ï¼‰
  - æˆ– `(create_time, id)` ç»„åˆï¼ˆé˜²é‡å¤ï¼‰

### 2. **åˆ†é¡µé€»è¾‘ï¼šæ¯æ¬¡æŸ¥ â€œ> ä¸Šä¸€æ‰¹æœ€å¤§ idâ€ çš„ N æ¡**

```sql
SELECT * FROM asset_detail 
WHERE id > :lastId 
ORDER BY id ASC 
LIMIT 1000;
```

### 3. **æµå¼å†™å…¥ Excel**

- ä½¿ç”¨ `SXSSFWorkbook(rowAccessWindowSize)` æ§åˆ¶å†…å­˜è¡Œæ•°ï¼ˆå¦‚ 100ï¼‰
- æ¯å¤„ç†ä¸€æ‰¹æ•°æ®å°± flush åˆ°ç£ç›˜ä¸´æ—¶æ–‡ä»¶
- æœ€ç»ˆä¸€æ¬¡æ€§å†™å‡ºåˆ° HTTP å“åº”æµ

### 4. **èµ„æºç®¡ç†**

- åŠæ—¶å…³é—­ workbookï¼ˆè°ƒç”¨ `dispose()` åˆ é™¤ä¸´æ—¶æ–‡ä»¶ï¼‰
- ä½¿ç”¨ try-with-resources é˜²æ­¢å†…å­˜/æ–‡ä»¶æ³„æ¼

### æ–‡ä»¶ä¸‹è½½çš„åº•å±‚å®ç°

Controller æ–¹æ³•**å‚æ•°åŒ…å« `HttpServletResponse`**ï¼Œå¹¶ä¸” **è¿”å› `void`**ï¼ŒSpring å°±ä¼šè®¤ä¸ºï¼š

> â€œè¿™ä¸ªæ–¹æ³•è¦è‡ªå·±æ§åˆ¶ HTTP å“åº”å†…å®¹ï¼Œæˆ‘ä¸å†å¸®ä½ è‡ªåŠ¨å†™ JSONã€‚â€

äºæ˜¯ï¼Œä½ å¯ä»¥ï¼š

- ç›´æ¥å¾€ `response.getOutputStream()` å†™äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚ Excelã€PDFã€å›¾ç‰‡ï¼‰
- è®¾ç½®æ­£ç¡®çš„ `Content-Type`
- è®¾ç½®æ–‡ä»¶ä¸‹è½½å¤´ `Content-Disposition`

âœ… **è¿™å°±æ˜¯â€œæ–‡ä»¶ä¸‹è½½â€çš„åº•å±‚å®ç°æ–¹å¼ã€‚**

**è¿™ç§æ–¹æ³•ä¸æ˜¯â€œè¿”å›æ•°æ®â€ï¼Œè€Œæ˜¯â€œç›´æ¥å¾€ç½‘ç»œè¿æ¥é‡ŒçŒ Excel æ–‡ä»¶â€ï¼Œæµè§ˆå™¨æ¥åˆ°åè‡ªåŠ¨ä¿å­˜ä¸ºæ–‡ä»¶ã€‚**

**Excel `.xlsx` æ–‡ä»¶å•ä¸ª Sheet æœ€å¤šåªèƒ½æœ‰ 1,048,576 è¡Œï¼ˆå³ 2Â²â° = 1048576ï¼‰**

### æ¨èã€‘è‡ªåŠ¨åˆ† Sheetï¼ˆæ¯æ»¡ 100 ä¸‡è¡Œæ–°å»ºä¸€ä¸ª Sheetï¼‰

è¿™æ˜¯å¤„ç†è¶…ç™¾ä¸‡æ•°æ®å¯¼å‡ºçš„æ ‡å‡†åšæ³•ã€‚

ç»“æœï¼š

APIFOXæµ‹è¯•  200 59.17 s 91.86 M

ä¸‹è½½æ–‡ä»¶ assets_export_1763005683127.xlsx  ï¼Œåˆ†ä¸¤ä¸ªsheetï¼Œæ•°æ®æ— è¯¯

## ä¸‰.å¤šçº¿ç¨‹åˆ†ç‰‡ + CompletableFuture å¹¶è¡Œå¯¼å‡º + å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—

### ä¸€ã€æ•´ä½“æ¶æ„è®¾è®¡

```text
ç”¨æˆ·è¯·æ±‚å¯¼å‡º
     â†“
[ExportTaskManager] åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ï¼ˆç”Ÿæˆ taskIdï¼‰
     â†“
è¿”å› { "taskId": "task_123" }
     â†“
å‰ç«¯è½®è¯¢ /export/status/{taskId}
     â†“
åå°å¯åŠ¨ CompletableFuture å¤šçº¿ç¨‹åˆ†ç‰‡å¯¼å‡º â†’ å„åˆ†ç‰‡å†™å…¥ä¸´æ—¶ .xlsx æ–‡ä»¶
     â†“
æ‰€æœ‰åˆ†ç‰‡å®Œæˆ â†’ åˆå¹¶ä¸ºæœ€ç»ˆæ–‡ä»¶ assets_export_task_123.xlsx
     â†“
çŠ¶æ€å˜ä¸º SUCCESSï¼Œå‰ç«¯å¯ä¸‹è½½
```

> ğŸ’¡ **å…³é”®ç‚¹**ï¼šæ¯ä¸ªåˆ†ç‰‡ç‹¬ç«‹å†™ä¸€ä¸ª `SXSSFWorkbook` ä¸´æ—¶æ–‡ä»¶ï¼Œæœ€åç”¨ POI åˆå¹¶ï¼ˆæˆ–ç›´æ¥æ‹¼æ¥ Sheetï¼‰

### äºŒã€CompletableFuture

### å°±åƒ"è®¢å•å–é¤å·"

```java
// åŒæ­¥æ–¹å¼ï¼šåœ¨é¤å…æ’é˜Ÿç­‰é¤
String meal = restaurant.cookMeal();  // é˜»å¡ç­‰å¾…ï¼Œä»€ä¹ˆéƒ½å¹²ä¸äº†

// å¼‚æ­¥æ–¹å¼ï¼šæ‹¿åˆ°å–é¤å·åå»åšå…¶ä»–äº‹æƒ…
CompletableFuture<String> mealFuture = restaurant.cookMealAsync();
// å¯ä»¥ç»§ç»­åšå…¶ä»–äº‹æƒ…...
String meal = mealFuture.get();  // é¤å¥½äº†å†å»å–
```

### æ ¸å¿ƒç‰¹ç‚¹

#### 1. å¼‚æ­¥æ‰§è¡Œ

```java
CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {
    // è¿™ä¸ªä»»åŠ¡ä¼šåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ
    return "å¼‚æ­¥è®¡ç®—ç»“æœ";
});

// ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­åšå…¶ä»–äº‹æƒ… ï¼ˆè¿™3ç§’å†…ä¸é˜»å¡ï¼‰
System.out.println("ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ...");

// éœ€è¦ç»“æœæ—¶è·å–ï¼ˆå¦‚æœè¿˜æ²¡å®Œæˆä¼šé˜»å¡ï¼‰
String result = future.get();
```

#### 2. é“¾å¼è°ƒç”¨ï¼ˆå›è°ƒï¼‰

```java
CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> "hello")
    .thenApply(s -> s + " world")      // ä¸Šä¸€æ­¥å®Œæˆåæ‰§è¡Œ
    .thenApply(String::toUpperCase)    // ç»§ç»­è½¬æ¢
    .thenCompose(s -> anotherAsync(s)); // ç»„åˆå¦ä¸€ä¸ªå¼‚æ­¥æ“ä½œ

System.out.println(future.get()); // è¾“å‡º: HELLO WORLD
```

æµç¨‹ï¼š

![å¹¶è¡Œæäº¤äº¤äº’é€»è¾‘](..\img\å¹¶è¡Œæäº¤äº¤äº’é€»è¾‘.png)

ä½¿ç”¨APIFOXæµ‹è¯•ï¼š

#### æ­¥éª¤ 1ï¸âƒ£ï¼šæäº¤å¯¼å‡ºä»»åŠ¡

- **æ–¹æ³•**ï¼š`POST`

- **URL**ï¼š`http://localhost:8029/export/async`

- å“åº”ç¤ºä¾‹

  ```json
  {
    "success": true,
    "data": "task_1731567890123"
  }
  ```

- âœ… **è®°å½• `taskId`**ï¼ˆå¦‚ `task_1731567890123`ï¼‰

> ğŸ’¡ Apifox æŠ€å·§ï¼šç”¨ **â€œæå–å˜é‡â€** è‡ªåŠ¨ä¿å­˜ taskId
>  åœ¨å“åº”åæ·»åŠ  **â€œåç½®æ“ä½œâ€ â†’ æå–å˜é‡**ï¼š
>  å˜é‡åï¼š`taskId`ï¼Œè¡¨è¾¾å¼ï¼š`$.data`

------

#### æ­¥éª¤ 2ï¸âƒ£ï¼šè½®è¯¢ä»»åŠ¡çŠ¶æ€ï¼ˆæ‰‹åŠ¨ or è‡ªåŠ¨ï¼‰

- **æ–¹æ³•**ï¼š`GET`

- **URL**ï¼š`http://localhost:8029/export/status/{{taskId}}`

- å“åº”ç¤ºä¾‹ï¼ˆè¿›è¡Œä¸­ï¼‰

  ```json
  {
    "success": true,
    "data": {
      "taskId": "task_1731567890123",
      "status": "RUNNING",
      "errorMessage": null
    }
  }
  ```

- å“åº”ç¤ºä¾‹ï¼ˆæˆåŠŸï¼‰

  ```json
  {
    "success": true,
    "data": {
      "status": "SUCCESS",
      "outputFile": "D:\\...\\assets_export_task_1731567890123.xlsx"
    }
  }
  ```

> â±ï¸ **æ€§èƒ½å…³é”®**ï¼šè®°å½•ä» `submit` åˆ° `status=SUCCESS` çš„æ€»è€—æ—¶ï¼ˆå¯ç”¨ Apifox çš„â€œæ—¶é—´çº¿â€æŸ¥çœ‹è¯·æ±‚è€—æ—¶ï¼‰

------

#### æ­¥éª¤ 3ï¸âƒ£ï¼šä¸‹è½½æ–‡ä»¶

- **æ–¹æ³•**ï¼š`GET`
- **URL**ï¼š`http://localhost:8029/export/download/{{taskId}}`
- é‡è¦è®¾ç½®
  - åœ¨ Apifox ä¸­å‹¾é€‰ **â€œSend and Downloadâ€**ï¼ˆPostman ç±»ä¼¼ï¼‰
  - å¦åˆ™ä¼šå°è¯•è§£æäºŒè¿›åˆ¶æµä¸º JSONï¼Œå¯¼è‡´é”™è¯¯

âœ… æˆåŠŸåä¼šå¼¹å‡ºä¿å­˜å¯¹è¯æ¡†ï¼Œæ–‡ä»¶å¯æ­£å¸¸æ‰“å¼€ã€‚

### é…ç½®æ­¥éª¤ï¼ˆå…¨è‡ªåŠ¨æµç¨‹ï¼‰

#### æ­¥éª¤ 1ï¼šåˆ›å»ºæ–°åœºæ™¯

- åœ¨ Apifox å·¦ä¾§ç‚¹å‡» **ã€Œåœºæ™¯ã€â†’ ã€Œæ–°å»ºåœºæ™¯ã€**
- å‘½åï¼š`å¯¼å‡ºèµ„äº§æ•°æ®å…¨æµç¨‹`

#### æ­¥éª¤ 2ï¼šæ·»åŠ ç¬¬ä¸€ä¸ªè¯·æ±‚ â€”â€” æäº¤ä»»åŠ¡

- ç‚¹å‡» **ã€Œ+ æ·»åŠ æ­¥éª¤ã€**
- é€‰æ‹©ä½ çš„ `POST /export/async` æ¥å£
- åœ¨è¯¥æ­¥éª¤çš„ã€Œåç½®æ“ä½œã€ä¸­ï¼š
  - ç‚¹å‡»ã€Œæå–å˜é‡ã€
    - å˜é‡åï¼š`taskId`
    - è¡¨è¾¾å¼ç±»å‹ï¼š`JSONPath`
    - è¡¨è¾¾å¼ï¼š`$.data`

#### æ­¥éª¤ 3ï¼šæ·»åŠ ç¬¬äºŒä¸ªè¯·æ±‚ â€”â€” è½®è¯¢çŠ¶æ€ï¼ˆå…³é”®ï¼ï¼‰

- ç‚¹å‡» **ã€Œ+ æ·»åŠ æ­¥éª¤ã€**

- é€‰æ‹© `GET /export/status/{{taskId}}`

- å¼€å¯è‡ªåŠ¨è½®è¯¢ï¼ˆApifox æ”¯æŒï¼ï¼‰ï¼š

  - åœ¨è¯¥æ­¥éª¤çš„ **ã€Œè®¾ç½®ã€** ä¸­æ‰¾åˆ° **ã€Œå¾ªç¯é‡è¯•ã€** æˆ– **ã€Œæ¡ä»¶ç­‰å¾…ã€**

  - è®¾ç½®ï¼š

    - **æœ€å¤§é‡è¯•æ¬¡æ•°**ï¼š30 æ¬¡ï¼ˆå‡è®¾æœ€å¤šç­‰ 60 ç§’ï¼‰

    - **é‡è¯•é—´éš”**ï¼š2000 msï¼ˆ2ç§’ï¼‰

    - æˆåŠŸæ¡ä»¶

      ï¼ˆæ–­è¨€ï¼‰ï¼š

      ```javascript
      pm.response.json().data.status === "SUCCESS"
      ```

  > ğŸ’¡ å¦‚æœ Apifox ç‰ˆæœ¬è¾ƒæ–°ï¼Œå¯èƒ½å« **â€œç›´åˆ°æ»¡è¶³æ¡ä»¶â€** æˆ– **â€œPollingâ€** åŠŸèƒ½ã€‚

> âš ï¸ å¦‚æœä½ çš„ Apifox æ²¡æœ‰å†…ç½®è½®è¯¢åŠŸèƒ½ï¼Œå¯ä»¥ç”¨ **JavaScript è„šæœ¬æ¨¡æ‹Ÿå¾ªç¯**ï¼ˆè§ä¸‹æ–¹å¤‡é€‰æ–¹æ¡ˆï¼‰ã€‚

#### æ­¥éª¤ 4ï¼šæ·»åŠ ç¬¬ä¸‰ä¸ªè¯·æ±‚ â€”â€” ä¸‹è½½æ–‡ä»¶

- ç‚¹å‡» **ã€Œ+ æ·»åŠ æ­¥éª¤ã€**
- é€‰æ‹© `GET /export/download/{{taskId}}`
- é‡è¦ï¼šåœ¨è¯¥è¯·æ±‚çš„ã€Œè®¾ç½®ã€ä¸­å‹¾é€‰ï¼š
  - âœ… **â€œå‘é€å¹¶ä¸‹è½½æ–‡ä»¶â€**ï¼ˆSend and Downloadï¼‰
  - è®¾ç½®ä¿å­˜è·¯å¾„ï¼ˆå¯é€‰ï¼‰

#### æ­¥éª¤ 5ï¼šè¿è¡Œæ•´ä¸ªåœºæ™¯

- ç‚¹å‡» **ã€Œè¿è¡Œã€** æŒ‰é’®
- Apifox ä¼šï¼š
  1. æäº¤ä»»åŠ¡ â†’ è·å– `taskId`
  2. è‡ªåŠ¨è½®è¯¢çŠ¶æ€ï¼Œç›´åˆ°è¿”å› `SUCCESS`
  3. è‡ªåŠ¨è§¦å‘ä¸‹è½½ï¼Œå¼¹å‡ºä¿å­˜å¯¹è¯æ¡†

## æµ‹è¯•ç¯èŠ‚çš„é—®é¢˜

1.æµ‹è¯•æäº¤ä»»åŠ¡æ¥å£æ—¶ï¼Œè§¦å‘å¯¼å‡ºåï¼Œ**10 ç§’å·¦å³ç”Ÿæˆäº†å¤šä¸ªåˆ†ç‰‡æ–‡ä»¶**ï¼ˆå¦‚ `task_123_part0.xlsx`, `part1.xlsx`...ï¼‰ï¼Œ**ä½†æœ€ç»ˆåˆå¹¶æ–‡ä»¶ï¼ˆ`assets_export_task_123.xlsx`ï¼‰ä¸€ç›´æ²¡å‡ºç°**

2.âœ… **åˆ†ç‰‡å¯¼å‡ºæˆåŠŸ**ï¼ŒâŒ **åˆå¹¶ç¯èŠ‚å¡ä½æˆ–å¤±è´¥äº†**ã€‚

### æ ¸å¿ƒé—®é¢˜å®šä½ï¼š**æ­»é” + çº¿ç¨‹æ± è€—å°½**

### **åœ¨åŒä¸€ä¸ªçº¿ç¨‹æ± ä¸­åµŒå¥—æäº¤ä»»åŠ¡ï¼**

```java
private String doParallelExport(String taskId) throws Exception {
    // ...
    for (int i = 0; i < threadCount; i++) {
        CompletableFuture<String> future = CompletableFuture
                .supplyAsync(() -> exportSegment(...), exportExecutor) // â† ä½¿ç”¨ exportExecutor
                .exceptionally(...);
        futures.add(future);
    }

    // âš ï¸ è¿™é‡Œä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰åˆ†ç‰‡å®Œæˆ
    List<String> partFiles = futures.stream()
            .map(CompletableFuture::join)  // â† é˜»å¡ç­‰å¾…ï¼
            .collect(Collectors.toList());

    return mergeParts(partFiles, taskId); // â† åˆå¹¶ä¹Ÿåœ¨åŒä¸€çº¿ç¨‹æ‰§è¡Œ
}
```

`doParallelExport` æœ¬èº«çš„è°ƒç”¨ä½ç½®

```java
exportExecutor.submit(() -> processExport(taskId)); // â† ä¹Ÿæ˜¯ç”¨ exportExecutor æäº¤çš„ï¼
```

### åæœï¼š**çº¿ç¨‹æ± æ­»é”ï¼ˆThread Pool Starvation / Deadlockï¼‰**

è§£å†³ï¼šä½¿ç”¨**åˆ†å±‚çº¿ç¨‹æ± **

æ–°å¢**åˆ†ç‰‡çº¿ç¨‹æ± **ï¼š`segmentExecutor`

```java
// æ–°å¢ä¸€ä¸ªä¸“é—¨ç”¨äºåˆ†ç‰‡çš„çº¿ç¨‹æ± 
private final ExecutorService segmentExecutor = Executors.newFixedThreadPool(
    Math.min(16, Runtime.getRuntime().availableProcessors() * 2)
);

// åŸæ¥çš„ exportExecutor åªç”¨äºæäº¤é¡¶å±‚ä»»åŠ¡ï¼ˆå¯é€‰ï¼Œå…¶å®å¯ä»¥ç›´æ¥ç”¨æ–°çº¿ç¨‹ï¼‰
```

ç„¶åï¼š

```java
CompletableFuture.supplyAsync(() -> exportSegment(...), segmentExecutor)
```

è€Œ `doParallelExport` çš„ `.join()` å‘ç”Ÿåœ¨ `processExport` çº¿ç¨‹ï¼ˆç”± `exportExecutor` æä¾›ï¼‰ï¼Œä½† `exportExecutor` å’Œ `segmentExecutor` æ˜¯**ä¸¤ä¸ªæ± **ï¼Œäº’ä¸å½±å“ â†’ **ä¸ä¼šæ­»é”**ã€‚

### æµ‹è¯•åå‘ç°å¤§æ–‡ä»¶åˆå¹¶å¤ªæ…¢ï¼Œå¼ƒç”¨åˆå¹¶æ–¹æ¡ˆï¼Œé€‰æ‹©**â€œå¤šçº¿ç¨‹åˆ†ç‰‡å¯¼å‡º + å¼‚æ­¥ä»»åŠ¡ç®¡ç† + åˆ†ç‰‡ ZIP ä¸‹è½½â€**çš„æ–¹æ¡ˆ

ä¿®æ”¹ä»£ç ï¼ˆä¿ç•™å¤šçº¿ç¨‹ï¼Œå»æ‰åˆå¹¶ï¼‰

â€œè€ƒè™‘åˆ° Excel å•æ–‡ä»¶æœ‰ 104 ä¸‡è¡Œé™åˆ¶ï¼Œå¯¹äº 160 ä¸‡æ¡æ•°æ®ï¼Œ**å¼ºè¡Œåˆå¹¶ä¸ä»…ä¼šå¤±è´¥ï¼Œè¿˜ä¼šå¯¼è‡´å†…å­˜æº¢å‡º**ã€‚

å› æ­¤è®¾è®¡äº†ä¸€ä¸ª **å¤šçº¿ç¨‹åˆ†ç‰‡å¯¼å‡º + ZIP æ‰“åŒ…** çš„æ–¹æ¡ˆï¼š

- ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹æ± éš”ç¦»ä»»åŠ¡è°ƒåº¦å’Œåˆ†ç‰‡å·¥ä½œï¼Œé¿å… CompletableFuture.join() å¯¼è‡´çš„æ­»é”ï¼›
- åŸºäº ID èŒƒå›´åˆ†ç‰‡ï¼Œå¹¶é‡‡ç”¨æ¸¸æ ‡åˆ†é¡µé¿å… OFFSET æ€§èƒ½é—®é¢˜ï¼›
- æ¯ä¸ªåˆ†ç‰‡ç‹¬ç«‹å†™å…¥ Excelï¼Œæœ€åæµå¼æ‰“åŒ…æˆ ZIPï¼Œ**å…¨ç¨‹å†…å­˜å¯æ§**ï¼›
- ç”¨æˆ·ä¸‹è½½ ZIP åå¯ç”¨ Excel æ‰“å¼€å¤šä¸ªæ–‡ä»¶ï¼Œæˆ–è‡ªè¡Œåˆå¹¶ã€‚
  è¿™æ ·æ—¢å‘æŒ¥äº†å¤šçº¿ç¨‹çš„å¹¶å‘ä¼˜åŠ¿ï¼Œåˆä¿è¯äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯æ‰©å±•æ€§

## âœ… ä¼˜åŠ¿æ€»ç»“

| ç»´åº¦           | ä½ çš„æ–¹æ¡ˆ                       | æ™®é€šæ–¹æ¡ˆ                    |
| -------------- | ------------------------------ | --------------------------- |
| **å¤šçº¿ç¨‹ä½¿ç”¨** | âœ… åŒçº¿ç¨‹æ±  + CompletableFuture | âŒ å•çº¿ç¨‹ or ç®€å• new Thread |
| **æ•°æ®é‡æ”¯æŒ** | âœ… æ”¯æŒåƒä¸‡çº§                   | âŒ è¶…è¿‡ 100w å°± OOM          |
| **Excel é™åˆ¶** | âœ… è§„é¿ 104w è¡Œé™åˆ¶             | âŒ å¿½ç•¥é™åˆ¶ï¼Œè¿è¡Œæ—¶æŠ¥é”™      |
| **å†…å­˜å®‰å…¨**   | âœ… æµå¼å†™ + æµå¼ ZIP            | âŒ å…¨åŠ è½½åˆ°å†…å­˜              |
| **å·¥ç¨‹å®è·µ**   | âœ… çŠ¶æ€ç®¡ç†ã€å¼‚å¸¸å¤„ç†ã€èµ„æºæ¸…ç† | âŒ æ— çŠ¶æ€ã€æ— æ¸…ç†            |
| **ç”¨æˆ·ä½“éªŒ**   | âœ… å¼‚æ­¥ä»»åŠ¡ + ä¸‹è½½é“¾æ¥          | âŒ é˜»å¡ç­‰å¾…                  |

æœ€ç»ˆæµ‹è¯•ç»“æœï¼š

æ€»è€—æ—¶ 13.80s

æ€»è¿”å›æ•°æ® 85.22MB

æ¥å£è¯·æ±‚è€—æ—¶ 647.00ms

å¹³å‡æ¥å£è¯·æ±‚è€—æ—¶ 4.56ms

APIFOXæŠ¥å‘Šï¼š

![APIFOXæŠ¥å‘Š](..\img\APIFOXæŠ¥å‘Š.png)

## å››.**å¤šæ•°æ®æºæ ¡éªŒæ¨¡å‹**å®éªŒï¼ˆCountDownLatch+å…¨å±€æˆåŠŸæ ‡å¿—AtomicBoolean)

åªæœ‰ `asset_detail` ä¸€å¼ è¡¨ï¼Œ **é€»è¾‘æ‹†åˆ†å­—æ®µä¸ºâ€œè™šæ‹Ÿå­ç³»ç»Ÿâ€**ï¼Œè¿™æ˜¯ä¼ä¸šçº§å¼€å‘ä¸­å¸¸è§çš„åšæ³•ï¼ˆå°¤å…¶åœ¨å•ä½“æ¶æ„æ¼”è¿›é˜¶æ®µï¼‰

**æ•°æ®é€»è¾‘ä¸Šæ¥æºäºå¤šä¸ªä¸šåŠ¡ç³»ç»Ÿï¼ˆè´¢åŠ¡ã€é‡‡è´­ã€è®¾å¤‡ï¼‰ï¼Œä½†ç‰©ç†ä¸Šå·²æ±‡èšä¸ºä¸€å¼ å®½è¡¨å­˜å‚¨**

| è™šæ‹Ÿå­ç³»ç»Ÿ   | å¯¹åº”å­—æ®µ                                | æ ¡éªŒè§„åˆ™ï¼ˆç¤ºä¾‹ï¼‰                       |
| ------------ | --------------------------------------- | -------------------------------------- |
| **è´¢åŠ¡ç³»ç»Ÿ** | `original_value`, `depreciation_method` | åŸå€¼ > 0ï¼ŒæŠ˜æ—§æ–¹æ³• âˆˆ {1,2}             |
| **é‡‡è´­ç³»ç»Ÿ** | `supplier_name`, `purchase_date`        | é‡‡è´­æ—¥æœŸ â‰¤ å½“å‰æ—¥æœŸï¼Œä¾›åº”å•†éç©º        |
| **è®¾å¤‡ç³»ç»Ÿ** | `status`, `location`, `custodian`       | çŠ¶æ€ âˆˆ {0,1,2,3}ï¼Œåœ¨ç”¨èµ„äº§å¿…é¡»æœ‰ä¿ç®¡äºº |

### **åªå¼€ 3 ä¸ªçº¿ç¨‹**æ˜¯æœ€ä¼˜è§£

- åªæœ‰ **3 ä¸ªç‹¬ç«‹æ ¡éªŒä»»åŠ¡**ï¼ˆè´¢åŠ¡ã€é‡‡è´­ã€è®¾å¤‡ï¼‰ï¼›
- æ¯ä¸ªä»»åŠ¡éƒ½æ˜¯ **CPU å¯†é›†å‹ï¼ˆå†…å­˜éå†ï¼‰**ï¼Œä¸æ˜¯ IO å¯†é›†å‹ï¼›
- çº¿ç¨‹æ•° = ä»»åŠ¡æ•° â†’ **æ— ç«äº‰ã€æ— ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€**ï¼›

**æ¨èï¼šä½œä¸ºå¯¼å‡ºæµç¨‹çš„å‰ç½®æ­¥éª¤ï¼ˆéç‹¬ç«‹æ¥å£ï¼‰**

- **ä¸šåŠ¡å¼ºè€¦åˆ**ï¼šç”¨æˆ·è¦çš„æ˜¯â€œå¯ä¿¡çš„å¯¼å‡ºæ•°æ®â€ï¼Œä¸æ˜¯â€œæ ¡éªŒæŠ¥å‘Šâ€ï¼›
- **é¿å…é‡å¤æŸ¥è¯¢**ï¼šå¦‚æœç‹¬ç«‹åšæ ¡éªŒæ¥å£ï¼Œå¯¼å‡ºæ—¶è¿˜å¾—å†æŸ¥ä¸€éæ•°æ® â†’ **IO ç¿»å€**ï¼›
- **å¤±è´¥å¿«é€Ÿç»ˆæ­¢**ï¼šæ ¡éªŒå¤±è´¥ç›´æ¥è¿”å›ï¼Œä¸æµªè´¹èµ„æºåšåç»­åˆ†ç‰‡ã€å†™æ–‡ä»¶ç­‰æ“ä½œã€‚

**å½±å“æå°ï¼Œä¸”æ”¶ç›Šè¿œå¤§äºæˆæœ¬**ã€‚

#### æ•°æ®è¯´è¯ï¼ˆä»¥ 160w æ•°æ®ä¸ºä¾‹ï¼‰ï¼š

| æ“ä½œ                   | è€—æ—¶ä¼°ç®—                        |
| ---------------------- | ------------------------------- |
| å…¨é‡åŠ è½½åˆ°å†…å­˜ï¼ˆListï¼‰ | ~3~5 ç§’ï¼ˆå–å†³äº DB å’Œç½‘ç»œï¼‰     |
| 3 ä¸ªæ ¡éªŒä»»åŠ¡ï¼ˆå¹¶è¡Œï¼‰   | **< 1 ç§’**ï¼ˆçº¯å†…å­˜éå†ï¼Œæ—  IOï¼‰ |
| å¤šçº¿ç¨‹åˆ†ç‰‡å¯¼å‡º         | ~12 ç§’                          |

160wæ•°æ®APIFOXæ ¡éªŒæ¥å£æµ‹è¯•

å…¨è¡¨æŸ¥è¯¢ + æ ¡éªŒ  è¿”å› 200 32.20 s 43 B

### æ–¹æ¡ˆ 1ï¼š**æ ¡éªŒä¸æŸ¥å…¨é‡ï¼ŒåªæŸ¥å…³é”®æ ·æœ¬æˆ–å…ƒæ•°æ®**

- æ¯”å¦‚åªæ ¡éªŒæœ€è¿‘ 7 å¤©æ–°å¢èµ„äº§ï¼›
- æˆ–åªæ£€æŸ¥å­—æ®µéç©ºç‡ã€çŠ¶æ€åˆ†å¸ƒç­‰èšåˆæŒ‡æ ‡ï¼›
- â†’ è€—æ—¶å¯é™è‡³ 1~2 ç§’ã€‚

### æ–¹æ¡ˆ 2ï¼š**ç¼“å­˜æ ¡éªŒç»“æœï¼ˆæŒ‰æ•°æ®ç‰ˆæœ¬ï¼‰**

- å¦‚æœèµ„äº§æ•°æ®æ¯å¤©å‡Œæ™¨åŒæ­¥ä¸€æ¬¡ï¼Œå¯ç¼“å­˜å½“æ—¥æ ¡éªŒç»“æœï¼›
- ç™½å¤©å¤šæ¬¡å¯¼å‡ºç›´æ¥å¤ç”¨ã€‚

æ— è®ºå¦‚ä½•ï¼Œå‰ç½®æ ¡éªŒåœ¨ 10 ç§’å†…å®Œæˆï¼ˆå®é™…çº¦ 0.5sï¼‰ï¼Œæ•´ä½“ä»»åŠ¡è€—æ—¶ä¸»è¦æ¥è‡ªç™¾ä¸‡çº§æ•°æ®åŠ è½½ï¼Œæ ¡éªŒå±‚å‡ ä¹æ— é¢å¤–å¼€é”€

**èµ„äº§å¯¼å‡ºæ€§èƒ½ä¸è´¨é‡ä¿éšœ**
é’ˆå¯¹ 160w+ èµ„äº§æ˜ç»†å¯¼å‡ºæ˜“å¤±è´¥ã€è€—æ—¶é•¿çš„é—®é¢˜ï¼Œè®¾è®¡â€œ**åŠ è½½ â†’ å¤šæºå¹¶è¡Œæ ¡éªŒ â†’ åˆ†ç‰‡å¯¼å‡º**â€æµæ°´çº¿ï¼š

- åŸºäºæ¸¸æ ‡åˆ†é¡µä¸åŒçº¿ç¨‹æ± å®ç° ID æ®µå¹¶è¡Œå¤„ç†ï¼Œç»“åˆ SXSSF æµå¼å†™å…¥ä¸ ZIP æ‰“åŒ…ï¼Œç«¯åˆ°ç«¯è€—æ—¶ä» 59s é™è‡³ 13.8sï¼›
- **åœ¨å¯¼å‡ºå‰åµŒå…¥è´¢åŠ¡ã€é‡‡è´­ã€è®¾å¤‡ä¸‰ç»´åº¦æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ**ï¼Œé€šè¿‡ `CountDownLatch` åè°ƒå¹¶è¡Œä»»åŠ¡ï¼Œ**æ ¡éªŒé€»è¾‘ä»…è€—æ—¶çº¦ 0.5sï¼Œå‡ ä¹æ— é¢å¤–å¼€é”€**ï¼Œä»»ä¸€è§„åˆ™å¤±è´¥å³ç»ˆæ­¢å¯¼å‡ºï¼Œä¿éšœäº¤ä»˜æ•°æ®å¯ä¿¡ã€‚